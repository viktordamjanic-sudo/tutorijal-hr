---
// Module Grid Component
import { PREDEFINED_TASKS } from '../lib/constants';
import type { Task } from '../types';

interface TaskWithPath extends Task {
  path: string;
}

const tasksWithPaths: TaskWithPath[] = PREDEFINED_TASKS.map(task => ({
  ...task,
  path: `/modul/${task.id}`,
}));

const audienceMeta: Record<string, { label: string; color: string; bg: string }> = {
  kids:    { label: 'Djeca',   color: '#059669', bg: '#f0fdf4' },
  seniors: { label: 'Stariji', color: '#d97706', bg: '#fffbeb' },
  all:     { label: 'Svi',     color: '#4f6ef7', bg: '#eef2ff' },
};

const difficultyMeta: Record<string, { label: string; color: string }> = {
  beginner:     { label: 'Poƒçetnik',  color: '#10b981' },
  intermediate: { label: 'Srednji',   color: '#f59e0b' },
  advanced:     { label: 'Napredni',  color: '#ef4444' },
};
---

<div class="module-grid">
  {tasksWithPaths.map((task) => {
    const aud = audienceMeta[task.targetAudience] || audienceMeta.all;
    const diff = difficultyMeta[task.difficulty] || difficultyMeta.beginner;
    return (
      <a href={task.path} class="module-card">
        <div class="module-top">
          <div class="module-icon">{task.icon}</div>
          <div class="module-badges">
            <span class="badge" style={`background: ${aud.bg}; color: ${aud.color};`}>{aud.label}</span>
            <span class="diff-dot" style={`background: ${diff.color};`} title={diff.label}></span>
          </div>
        </div>
        <h3 class="module-title">{task.title.replace(/^[\u{1F300}-\u{1FFFF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}]\s*/u, '')}</h3>
        <p class="module-desc">{task.scenario}</p>
        <div class="module-footer">
          <span class="module-diff" style={`color: ${diff.color};`}>{diff.label}</span>
          <span class="module-arrow">‚Üí</span>
        </div>
      </a>
    );
  })}

  <!-- Coming soon card -->
  <div class="module-card coming-soon">
    <div class="module-top">
      <div class="module-icon" style="opacity:.4;">üîÆ</div>
    </div>
    <h3 class="module-title" style="color: #9ca3af;">Uskoro...</h3>
    <p class="module-desc" style="color:#c4c9d4;">AI kontinuirano generira nove module. Procesiranje novih sektora u tijeku.</p>
    <div class="coming-tags">
      {['JEZIK', 'FINANCIJE', 'ZDRAVLJE'].map(tag => (
        <span class="coming-tag">{tag}</span>
      ))}
    </div>
  </div>
</div>

<style>
  .module-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 14px;
  }
  .module-card {
    background: #fafaf8;
    border: 1px solid #e8e8e4;
    border-radius: 14px;
    padding: 18px 18px 14px;
    text-decoration: none; color: inherit;
    display: flex; flex-direction: column; gap: 8px;
    transition: all .18s;
    cursor: pointer;
  }
  .module-card:hover:not(.coming-soon) {
    background: #fff;
    border-color: rgba(79,110,247,.3);
    box-shadow: 0 4px 18px rgba(79,110,247,.10);
    transform: translateY(-2px);
  }
  .coming-soon { opacity: .65; cursor: default; }

  .module-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px; }
  .module-icon { font-size: 28px; line-height: 1; }
  .module-badges { display: flex; align-items: center; gap: 7px; }
  .badge {
    font-size: 10px; font-weight: 700;
    text-transform: uppercase; letter-spacing: .05em;
    padding: 3px 9px; border-radius: 99px;
  }
  .diff-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
  .module-title { font-size: 14.5px; font-weight: 700; color: #1e1e1e; line-height: 1.3; }
  .module-desc {
    font-size: 12.5px; color: #6b7280; font-weight: 500;
    line-height: 1.55; flex: 1;
    display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
  }
  .module-footer {
    display: flex; align-items: center; justify-content: space-between;
    padding-top: 10px; border-top: 1px solid #e8e8e4; margin-top: 4px;
  }
  .module-diff { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: .05em; }
  .module-arrow { color: #d1d5db; font-size: 14px; transition: all .15s; }
  .module-card:hover .module-arrow { color: #4f6ef7; transform: translateX(3px); }

  .coming-tags { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 4px; }
  .coming-tag {
    font-size: 10px; font-weight: 700;
    text-transform: uppercase; letter-spacing: .06em;
    padding: 3px 8px; border-radius: 99px;
    background: #f3f4f6; color: #9ca3af;
    border: 1px solid #e8e8e4;
  }
</style>
