---
// Module Grid Component ‚Äî Uses shared theme tokens
import { PREDEFINED_TASKS } from '../lib/constants';
import type { Task } from '../types';

interface TaskWithPath extends Task {
  path: string;
}

const tasksWithPaths: TaskWithPath[] = PREDEFINED_TASKS.map(task => ({
  ...task,
  path: `/modul/${task.id}`,
}));

const audienceMeta: Record<string, { label: string; color: string; bg: string }> = {
  kids:    { label: 'Djeca',   color: 'var(--aud-kids)',    bg: 'var(--aud-kids-bg)' },
  seniors: { label: 'Stariji', color: 'var(--aud-seniors)', bg: 'var(--aud-seniors-bg)' },
  all:     { label: 'Svi',     color: 'var(--aud-all)',     bg: 'var(--aud-all-bg)' },
};

const difficultyMeta: Record<string, { label: string; color: string }> = {
  beginner:     { label: 'Poƒçetnik',  color: 'var(--diff-beginner)' },
  intermediate: { label: 'Srednji',   color: 'var(--diff-intermediate)' },
  advanced:     { label: 'Napredni',  color: 'var(--diff-advanced)' },
};
---

<div class="t-grid">
  {tasksWithPaths.map((task) => {
    const aud = audienceMeta[task.targetAudience] || audienceMeta.all;
    const diff = difficultyMeta[task.difficulty] || difficultyMeta.beginner;
    return (
      <a href={task.path} class="t-card">
        <div class="t-card__top">
          <span class="t-card__icon">{task.icon}</span>
          <div class="t-card__badges">
            <span class="t-badge" style={`background: ${aud.bg}; color: ${aud.color};`}>{aud.label}</span>
            <span class="t-badge t-badge--diff" style={`background: ${diff.color};`} title={diff.label}></span>
          </div>
        </div>
        <h3 class="t-card__title">{task.title.replace(/^[\u{1F300}-\u{1FFFF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}]\s*/u, '')}</h3>
        <p class="t-card__desc">{task.scenario}</p>
        <div class="t-card__footer">
          <span class="module-diff" style={`color: ${diff.color};`}>{diff.label}</span>
          <span class="t-card__arrow">‚Üí</span>
        </div>
      </a>
    );
  })}

  <!-- Coming soon card -->
  <div class="t-card t-card--disabled">
    <div class="t-card__top">
      <span class="t-card__icon" style="opacity:.4;">üîÆ</span>
    </div>
    <h3 class="t-card__title" style="color: var(--color-text-muted);">Uskoro...</h3>
    <p class="t-card__desc" style="color: #c4c9d4;">AI kontinuirano generira nove module iz aktualnih vijesti.</p>
    <div class="coming-tags">
      {['JEZIK', 'FINANCIJE', 'ZDRAVLJE'].map(tag => (
        <span class="coming-tag">{tag}</span>
      ))}
    </div>
  </div>
</div>

<style>
  .module-diff {
    font-size: 11px; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.05em;
  }
  .coming-tags { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 4px; }
  .coming-tag {
    font-size: var(--font-size-xs); font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.06em;
    padding: 3px 8px; border-radius: var(--radius-pill);
    background: #f3f4f6; color: var(--color-text-muted);
    border: 1px solid var(--color-border);
  }
</style>
