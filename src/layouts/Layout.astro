---
// Base Layout Component
import { SignedIn, SignedOut, UserButton } from '@clerk/astro/components';
import '../styles/theme.css';

interface Props {
  title: string;
  hideSidebar?: boolean;
}

const { title, hideSidebar = false } = Astro.props;
const currentPath = Astro.url.pathname;
---

<!DOCTYPE html>
<html lang="hr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <meta name="description" content="Nauƒçi koristiti AI za rje≈°avanje stvarnih problema - od parkinga do pade≈æa!" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
      *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
      :root {
        /* Layout aliases ‚Äî theme tokens are in theme.css */
        --accent: var(--color-accent);
        --accent-soft: var(--color-accent-soft);
        --surface: var(--color-surface);
        --bg: var(--color-bg);
        --text-primary: var(--color-text-primary);
        --text-secondary: var(--color-text-secondary);
        --text-muted: var(--color-text-muted);
        --border: var(--color-border);
      }
      html { height: 100%; }
      body {
        font-family: 'Inter', system-ui, sans-serif;
        background: var(--bg);
        color: var(--text-primary);
        min-height: 100vh;
        display: flex;
        -webkit-font-smoothing: antialiased;
      }

      /* ===== SIDEBAR ‚Äî LIGHT ===== */
      .sidebar {
        width: var(--sidebar-w);
        min-height: 100vh;
        background: #fff;
        border-right: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        position: fixed;
        left: 0; top: 0; bottom: 0;
        z-index: 100;
        transition: transform .25s ease;
      }
      .sidebar-logo {
        display: flex; align-items: center; gap: 10px;
        padding: 18px 18px 14px;
        border-bottom: 1px solid var(--border);
        text-decoration: none;
      }
      .sidebar-logo-icon {
        width: 36px; height: 36px;
        background: linear-gradient(135deg, #4f6ef7, #7c3aed);
        border-radius: 11px;
        display: flex; align-items: center; justify-content: center;
        font-size: 17px; flex-shrink: 0;
        box-shadow: 0 2px 8px rgba(79,110,247,.3);
      }
      .sidebar-logo-text { color: var(--text-primary); font-weight: 700; font-size: 14.5px; line-height: 1.2; }
      .sidebar-logo-sub { color: var(--text-muted); font-size: 11px; font-weight: 500; }

      .nav-section { padding: 12px 10px; flex: 1; }
      .nav-label {
        color: var(--text-muted); font-size: 10px; font-weight: 600;
        letter-spacing: .08em; text-transform: uppercase;
        padding: 0 10px; margin-bottom: 6px; margin-top: 10px;
      }
      .nav-item {
        display: flex; align-items: center; gap: 10px;
        padding: 9px 12px; border-radius: var(--radius-sm);
        color: var(--text-secondary); font-size: 13.5px; font-weight: 500;
        text-decoration: none; transition: all .15s;
        margin-bottom: 2px;
      }
      .nav-item:hover { background: #f5f5f0; color: var(--text-primary); }
      .nav-item.active { background: var(--accent-soft); color: var(--accent); font-weight: 600; }
      .nav-item svg { width: 17px; height: 17px; flex-shrink: 0; }
      .nav-item .badge {
        margin-left: auto;
        background: var(--accent); color: #fff;
        font-size: 10px; font-weight: 700;
        padding: 1px 7px; border-radius: 99px;
      }

      .sidebar-footer {
        padding: 14px 12px;
        border-top: 1px solid var(--border);
      }
      .sidebar-user {
        display: flex; align-items: center; gap: 9px;
        padding: 8px 10px; border-radius: var(--radius-sm);
        color: var(--text-secondary); font-size: 13px;
      }

      /* ===== MAIN SHELL ===== */
      .app-shell {
        margin-left: var(--sidebar-w);
        flex: 1; display: flex; flex-direction: column; min-height: 100vh;
      }
      .topbar {
        height: 56px;
        background: var(--surface);
        border-bottom: 1px solid var(--border);
        display: flex; align-items: center;
        padding: 0 24px; gap: 12px;
        position: sticky; top: 0; z-index: 50;
      }
      .topbar-title { font-weight: 700; font-size: 16px; color: var(--text-primary); flex: 1; }
      .topbar-actions { display: flex; align-items: center; gap: 8px; }
      .topbar-btn {
        width: 34px; height: 34px; border-radius: 8px; border: none;
        background: transparent; cursor: pointer;
        display: flex; align-items: center; justify-content: center;
        color: var(--text-muted); transition: background .15s;
      }
      .topbar-btn:hover { background: var(--bg); color: var(--text-secondary); }
      .topbar-btn svg { width: 18px; height: 18px; }

      /* Page content */
      .page-content { flex: 1; padding: 24px; }
      .page-content-full { padding: 0; display: flex; flex-direction: column; height: 100vh; }

      /* Scrollbars */
      ::-webkit-scrollbar { width: 5px; height: 5px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: rgba(0,0,0,.1); border-radius: 99px; }

      /* Mobile */
      .menu-toggle { display: none; }
      @media (max-width: 768px) {
        .sidebar { transform: translateX(-100%); }
        .sidebar.open { transform: translateX(0); }
        .app-shell { margin-left: 0; }
        .menu-toggle {
          display: flex; align-items: center; justify-content: center;
          width: 36px; height: 36px; border-radius: 8px;
          border: none; background: var(--bg); cursor: pointer;
          color: var(--text-secondary);
        }
        .sidebar-overlay {
          display: none; position: fixed; inset: 0;
          background: rgba(0,0,0,.3); z-index: 99;
        }
        .sidebar-overlay.open { display: block; }
      }
    </style>
  </head>
  <body>
    <!-- Mobile overlay -->
    <div class="sidebar-overlay" id="sidebar-overlay" onclick="closeSidebar()"></div>

    {!hideSidebar && (
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <a href="/" class="sidebar-logo">
        <div class="sidebar-logo-icon">üéì</div>
        <div>
          <div class="sidebar-logo-text">tutorijal.hr</div>
          <div class="sidebar-logo-sub">AI Tools ¬∑ 2026</div>
        </div>
      </a>

      <nav class="nav-section">
        <div class="nav-label">Poƒçetna</div>
        <a href="/" class={`nav-item ${currentPath === '/' ? 'active' : ''}`}>
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
          Poƒçetna
        </a>
        <a href="/#lab" class={`nav-item ${currentPath.startsWith('/modul/') ? 'active' : ''}`}>
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg>
          Prompt Lab
          <span class="badge">12</span>
        </a>

        <div class="nav-label" style="margin-top:14px">Naprednije</div>
        <a href="/#lekcije" class={`nav-item ${currentPath.startsWith('/lekcija') ? 'active' : ''}`}>
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>
          AI Agenti
          <span class="badge">5</span>
        </a>

        <SignedIn>
          <div class="nav-label" style="margin-top:14px">Raƒçun</div>
          <a href="/profil" class={`nav-item ${currentPath.startsWith('/profil') ? 'active' : ''}`}>
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
            Profil
          </a>
        </SignedIn>
      </nav>

      <div class="sidebar-footer">
        <SignedIn>
          <div class="sidebar-user">
            <UserButton afterSignOutUrl="/" />
            <span style="font-size:12px; color: var(--text-muted);">Moj raƒçun</span>
          </div>
        </SignedIn>
      </div>
    </aside>
    )}

    <!-- Main Shell -->
    <div class="app-shell" style={hideSidebar ? 'margin-left:0' : ''}>
      <!-- Top Bar (only shown when sidebar is visible) -->
      {!hideSidebar && (
      <header class="topbar">
        <button class="menu-toggle" onclick="toggleSidebar()" aria-label="Izbornik">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
        </button>
        <span class="topbar-title">{title.split('|')[0].trim()}</span>
        <div class="topbar-actions">
          <button class="topbar-btn" title="Obavijesti">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg>
          </button>
          <button class="topbar-btn" title="Pretra≈æi">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
          </button>
          <SignedIn>
            <div style="border-radius:8px;overflow:hidden;width:34px;height:34px;display:flex;align-items:center;justify-content:center;">
              <UserButton afterSignOutUrl="/" />
            </div>
          </SignedIn>
          <SignedOut>
            <a href="/sign-in" style="font-size:13px;font-weight:600;color:#4f6ef7;text-decoration:none;padding:6px 14px;border-radius:8px;border:1.5px solid #4f6ef7;transition:all .15s;" onmouseover="this.style.background='#4f6ef7';this.style.color='#fff'" onmouseout="this.style.background='transparent';this.style.color='#4f6ef7'">Prijava</a>
          </SignedOut>
        </div>
      </header>
      )}

      <!-- Main Content -->
      <main class={`page-content ${hideSidebar ? 'page-content-full' : ''}`}>
        <slot />
      </main>
    </div>

    <script is:inline>
      function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        if (sidebar) sidebar.classList.toggle('open');
        if (overlay) overlay.classList.toggle('open');
      }
      function closeSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        if (sidebar) sidebar.classList.remove('open');
        if (overlay) overlay.classList.remove('open');
      }
    </script>
  </body>
</html>
