const V=(e,n,s)=>!e&&s?C(s):x(n),C=e=>{const n=e.userId,s=e.user,r=e.sessionId,o=e.sessionStatus,i=e.sessionClaims;return{userId:n,user:s,sessionId:r,session:e.session,sessionStatus:o,sessionClaims:i,organization:e.organization,orgId:e.orgId,orgRole:e.orgRole,orgPermissions:e.orgPermissions,orgSlug:e.orgSlug,actor:e.actor,factorVerificationAge:e.factorVerificationAge}},x=e=>{const n=e.user?e.user.id:e.user,s=e.user,r=e.session?e.session.id:e.session,o=e.session,i=e.session?.status,t=e.session?e.session.lastActiveToken?.jwt?.claims:null,h=e.session?e.session.factorVerificationAge:null,v=o?.actor,g=e.organization,f=e.organization?e.organization.id:e.organization,l=g?.slug,a=g&&s?.organizationMemberships?.find(O=>O.organization.id===f),U=a&&a.permissions;return{userId:n,user:s,sessionId:r,session:o,sessionStatus:i,sessionClaims:t,organization:g,orgId:f,orgRole:a&&a.role,orgSlug:l,orgPermissions:U,actor:v,factorVerificationAge:h}},P="METHOD_CALLED";function D(e,n){return{event:P,eventSamplingRate:.1,payload:{method:e,...n}}}let u=[],d=0;const m=4;let T=0,I=e=>{let n=[],s={get(){return s.lc||s.listen(()=>{})(),s.value},lc:0,listen(r){return s.lc=n.push(r),()=>{for(let i=d+m;i<u.length;)u[i]===r?u.splice(i,m):i+=m;let o=n.indexOf(r);~o&&(n.splice(o,1),--s.lc||s.off())}},notify(r,o){T++;let i=!u.length;for(let t of n)u.push(t,s.value,r,o);if(i){for(d=0;d<u.length;d+=m)u[d](u[d+1],u[d+2],u[d+3]);u.length=0}},off(){},set(r){let o=s.value;o!==r&&(s.value=r,s.notify(o))},subscribe(r){let o=s.listen(r);return r(s.value),o},value:e};return s};const $=5,p=6,E=10;let Q=(e,n,s,r)=>(e.events=e.events||{},e.events[s+E]||(e.events[s+E]=r(o=>{e.events[s].reduceRight((i,t)=>(t(i),i),{shared:{},...o})})),e.events[s]=e.events[s]||[],e.events[s].push(n),()=>{let o=e.events[s],i=o.indexOf(n);o.splice(i,1),o.length||(delete e.events[s],e.events[s+E](),delete e.events[s+E])}),F=1e3,_=(e,n)=>Q(e,r=>{let o=n(r);o&&e.events[p].push(o)},$,r=>{let o=e.listen;e.listen=(...t)=>(!e.lc&&!e.active&&(e.active=!0,r()),o(...t));let i=e.off;return e.events[p]=[],e.off=()=>{i(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let t of e.events[p])t();e.events[p]=[]}},F)},()=>{e.listen=o,e.off=i}}),N=(e,n,s)=>{Array.isArray(e)||(e=[e]);let r,o,i=()=>{if(o===T)return;o=T;let f=e.map(l=>l.get());if(!r||f.some((l,a)=>l!==r[a])){r=f;let l=n(...f);l&&l.then&&l.t?l.then(a=>{r===f&&t.set(a)}):(t.set(l),o=T)}},t=I(void 0),h=t.get;t.get=()=>(i(),h());let v,g=s?()=>{clearTimeout(v),v=setTimeout(i)}:i;return _(t,()=>{let f=e.map(l=>l.listen(g));return i(),()=>{for(let l of f)l()}}),t},c=(e,n)=>N(e,n),G=(e,n)=>N(e,n,!0),R=(e={})=>{let n=I(e);return n.setKey=function(s,r){let o=n.value;typeof r>"u"&&s in n.value?(n.value={...n.value},delete n.value[s],n.notify(o,s)):n.value[s]!==r&&(n.value={...n.value,[s]:r},n.notify(o,s))},n};var S=R({isLoaded:!1,client:void 0,user:void 0,session:void 0,organization:void 0}),H=R(),A=I(null),B=c([S],e=>e.isLoaded),z=G([S,H],(e,n)=>V(e.isLoaded,{session:e.session,user:e.user,organization:e.organization,client:e.client},n));c([z],e=>e.user);var J=c([z],e=>e.session),q=c([z],e=>e.organization),L=c([S],e=>e.client),W=c([A],e=>e);c([L],e=>e?.sessions);var Y=c([L],e=>e?.signIn),w=c([L],e=>e?.signUp);c([A],e=>e?.billing);var M=(e,n)=>{_(e,()=>{A.get()?.telemetry?.record(D(n))})};M(Y,"$signInStore");M(w,"$signUpStore");M(q,"$organizationStore");export{J as $,B as a,z as b,A as c,S as d,W as e,H as f};
